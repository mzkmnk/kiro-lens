# Requirements Document

## Introduction

現在のkiro-lensは起動したフォルダの.kiroディレクトリのみを管理対象としていますが、ユーザーが任意のパスを指定して複数のプロジェクトの.kiroディレクトリを管理できるようにする機能を追加します。また、ユーザーの設定やパス情報を永続化して、次回起動時にも保持されるようにします。

## Requirements

### Requirement 1

**User Story:** ユーザーとして、UIから任意のパスを入力して、そのパス配下の.kiroディレクトリを管理対象として追加したい。これにより、現在作業しているディレクトリ以外のプロジェクトも管理できるようになる。

#### Acceptance Criteria

1. WHEN ユーザーがダッシュボードの「プロジェクト追加」ボタンをクリック THEN パス入力ダイアログが表示される
2. WHEN ユーザーが有効なディレクトリパスを入力して確定 THEN そのパス配下の.kiroディレクトリが存在するかチェックされる
3. WHEN 入力されたパス配下に.kiroディレクトリが存在する THEN プロジェクトリストに新しいプロジェクトが追加される
4. WHEN 入力されたパス配下に.kiroディレクトリが存在しない THEN エラーメッセージが表示され、プロジェクトは追加されない
5. WHEN 無効なパス（存在しないディレクトリ、アクセス権限なし等）が入力された THEN 適切なエラーメッセージが表示される

### Requirement 2

**User Story:** ユーザーとして、複数のプロジェクトの.kiroディレクトリを同時に管理したい。これにより、複数のプロジェクト間を素早く切り替えて作業できるようになる。

#### Acceptance Criteria

1. WHEN ダッシュボードが表示される THEN 管理対象の全プロジェクトがリスト形式で表示される
2. WHEN ユーザーがプロジェクトリストから特定のプロジェクトを選択 THEN そのプロジェクトの.kiroディレクトリの内容がファイルツリーに表示される
3. WHEN ユーザーがプロジェクトを削除 THEN 確認ダイアログが表示され、確定後にプロジェクトリストから削除される
4. WHEN 複数のプロジェクトが管理されている THEN 現在選択中のプロジェクトが視覚的に識別できる
5. WHEN プロジェクトの.kiroディレクトリが削除または移動された THEN プロジェクトリストで無効状態として表示される

### Requirement 3

**User Story:** ユーザーとして、設定したプロジェクトパスや個人設定が永続化されて、次回起動時にも保持されていてほしい。これにより、毎回プロジェクトを再設定する手間が省ける。

#### Acceptance Criteria

1. WHEN ユーザーがプロジェクトを追加または削除 THEN 変更内容が自動的に設定ファイルに保存される
2. WHEN kiro-lensが起動される THEN ユーザーホームディレクトリの.kiro-lensフォルダから設定が読み込まれる
3. WHEN 設定ファイルが存在しない THEN デフォルト設定で初期化され、新しい設定ファイルが作成される
4. WHEN 設定ファイルが破損している THEN エラーログを出力し、デフォルト設定で初期化される
5. WHEN ユーザーが設定をリセット THEN 確認ダイアログ後に設定ファイルが初期状態に戻される

### Requirement 4

**User Story:** ユーザーとして、プロジェクトパスの入力時にファイルシステムブラウザやパス補完機能を使いたい。これにより、正確なパスを素早く入力できるようになる。

#### Acceptance Criteria

1. WHEN パス入力ダイアログが表示される THEN ファイルブラウザボタンが利用可能である
2. WHEN ユーザーがファイルブラウザボタンをクリック THEN ネイティブのディレクトリ選択ダイアログが開く
3. WHEN ユーザーがディレクトリ選択ダイアログでフォルダを選択 THEN 選択されたパスが入力フィールドに自動入力される
4. WHEN ユーザーがパスを手動入力中 THEN 存在するディレクトリパスの候補が表示される
5. WHEN 相対パスが入力された THEN 絶対パスに変換されて処理される

### Requirement 5

**User Story:** 開発者として、設定ファイルの構造が拡張可能で、将来的な機能追加に対応できるようにしたい。これにより、新機能追加時の設定管理が容易になる。

#### Acceptance Criteria

1. WHEN 設定ファイルが作成される THEN JSON形式で構造化されたデータとして保存される
2. WHEN 新しい設定項目が追加される THEN 既存の設定ファイルとの後方互換性が保たれる
3. WHEN 設定ファイルのバージョンが異なる THEN 適切なマイグレーション処理が実行される
4. WHEN 設定ファイルにスキーマ検証 THEN 無効なデータが検出された場合は適切にエラーハンドリングされる
5. WHEN 設定ファイルが読み書きされる THEN 適切な権限設定（600）で保護される
