# パス管理システム 実装タスク

## 完了済みタスク

なし

## 実装タスク

- [x] 1. 共通型定義の拡張
  - sharedパッケージにProjectInfo、AppConfig、ValidationResult等の新しい型定義を追加
  - 既存のProjectResponse型を拡張してid、addedAt等のフィールドを追加
  - API リクエスト/レスポンス型（AddProjectRequest、ProjectListResponse等）を定義
  - _要件: 1.1, 2.1, 3.1, 5.1_

- [x] 2. 設定管理関数の実装
  - packages/backend/src/services/configService.tsを作成
  - ユーザーホームディレクトリの.kiro-lensフォルダ管理関数を実装
  - 設定ファイル（config.json）の読み書き関数を実装
  - 設定ファイルのバリデーションとデフォルト値設定関数を実装
  - ファイル権限設定（600）とエラーハンドリング関数を実装
  - _要件: 3.1, 3.2, 3.3, 3.4, 5.4_

- [x] 3. ファイルシステム操作関数の実装
  - packages/backend/src/services/fileSystemService.tsを作成
  - パス解決と正規化関数（相対パス→絶対パス変換）を実装
  - ディレクトリ存在確認と.kiroディレクトリチェック関数を実装
  - ディレクトリ権限チェック関数を実装
  - パス入力補完のための候補取得関数を実装
  - _要件: 1.2, 1.3, 1.4, 1.5, 4.5_

- [x] 4. プロジェクト管理関数の実装
  - packages/backend/src/services/projectService.tsを作成
  - 複数プロジェクト管理関数（追加、削除、一覧取得）を実装
  - プロジェクトパス検証関数を実装
  - 現在選択中のプロジェクト管理関数を実装
  - 設定管理関数とファイルシステム操作関数との連携を実装
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3_

- [ ] 5. 新しいAPIエンドポイントの実装
  - 既存のpackages/backend/src/routes/project.tsを拡張
  - POST /api/projects（プロジェクト追加）エンドポイントを実装
  - DELETE /api/projects/:id（プロジェクト削除）エンドポイントを実装
  - GET /api/projects（プロジェクト一覧取得）エンドポイントを実装
  - POST /api/projects/validate-path（パス検証）エンドポイントを実装
  - PUT /api/projects/:id/select（プロジェクト選択）エンドポイントを実装
  - _要件: 1.1, 1.2, 2.1, 2.2, 2.3_

- [ ] 6. フロントエンドAPIクライアントの拡張
  - packages/frontend/src/services/api.tsに新しいAPIエンドポイント用のメソッドを追加
  - プロジェクト管理用のAPIクライアントメソッドを実装
  - エラーハンドリングと型安全性を確保した実装
  - _要件: 1.1, 2.1, 2.2_

- [ ] 7. ProjectManagerコンポーネントの実装
  - packages/frontend/src/components/ProjectManager.tsxを作成
  - プロジェクト一覧表示機能を実装
  - プロジェクト選択とアクティブ状態表示機能を実装
  - プロジェクト削除機能（確認ダイアログ付き）を実装
  - 無効なプロジェクトの視覚的表示機能を実装
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 8. PathDialogコンポーネントの実装
  - packages/frontend/src/components/PathDialog.tsxを作成
  - パス入力フィールドとバリデーション機能を実装
  - リアルタイムパス検証とエラー表示機能を実装
  - パス入力補完機能（候補表示）を実装
  - 確定・キャンセルボタンとイベントハンドリングを実装
  - _要件: 1.1, 1.4, 1.5, 4.4_

- [ ] 9. FileBrowserコンポーネントの実装
  - packages/frontend/src/components/FileBrowser.tsxを作成
  - Web File System Access APIの対応状況チェック機能を実装
  - showDirectoryPicker()を使用したディレクトリ選択機能を実装
  - 選択されたパスの自動入力機能を実装
  - API未対応ブラウザ向けのフォールバック表示を実装
  - _要件: 4.1, 4.2, 4.3_

- [ ] 10. Dashboardコンポーネントの統合
  - 既存のpackages/frontend/src/components/Dashboard.tsxを拡張
  - ProjectManagerコンポーネントの統合
  - プロジェクト追加ボタンとPathDialogの統合
  - 現在選択中のプロジェクト表示の更新
  - プロジェクト切り替え時のファイルツリー更新機能を実装
  - _要件: 1.1, 2.1, 2.4_

- [ ] 11. 設定永続化機能のテスト実装
  - 設定管理関数の単体テスト実装
  - 設定ファイル作成、読み込み、更新のテストケース作成
  - 設定ファイル破損時の復旧処理テスト実装
  - ファイル権限設定のテスト実装
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ] 12. プロジェクト管理機能のテスト実装
  - プロジェクト管理関数の単体テスト実装
  - プロジェクト追加、削除、切り替えのテストケース作成
  - パス検証関数のテスト実装
  - エラーケース（無効パス、権限なし等）のテスト実装
  - _要件: 1.2, 1.3, 1.4, 1.5_

- [ ] 13. UIコンポーネントのテスト実装
  - ProjectManager、PathDialog、FileBrowserコンポーネントの単体テスト実装
  - ユーザーインタラクション（クリック、入力、選択）のテスト実装
  - エラー状態とローディング状態の表示テスト実装
  - _要件: 1.1, 2.1, 4.1_

- [ ] 14. 統合テストとE2Eテストの実装
  - プロジェクト追加から切り替えまでのフルフローテスト実装
  - 設定永続化の動作確認テスト実装
  - ブラウザ再起動時の状態復元テスト実装
  - エラーハンドリングの統合テスト実装
  - _要件: 1.1, 2.1, 3.1, 3.2_

- [ ] 15. エラーハンドリングとユーザビリティ改善
  - 各種エラーケースでの適切なメッセージ表示実装
  - ローディング状態とプログレス表示の実装
  - ユーザーフレンドリーなエラーメッセージとリカバリー提案の実装
  - パフォーマンス最適化（デバウンス、キャッシュ等）の実装
  - _要件: 1.4, 1.5, 2.5, 3.4_
