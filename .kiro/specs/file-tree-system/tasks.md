# file-tree-system 実装計画

## 完了済みタスク

なし（新規実装）

## TDD実装タスク

- [x] 1. 共通型定義の拡張（TDD）
  - shared パッケージにFileTreeResponse型を追加
  - 既存のFileItem型との統合確認
  - TypeScriptコンパイルエラーなしを確認
  - _要件: 4.1_

- [x] 2. バックエンドFileTreeServiceの実装（TDD）
- [x] 2.1 FileTreeServiceテスト作成（Red）
  - プロジェクトファイル取得のテスト作成
  - ディレクトリ読み取り機能のテスト作成
  - FileItem変換機能のテスト作成
  - エラーケース（プロジェクト未存在、権限エラー等）のテスト作成
  - _要件: 1.3, 1.4, 1.5_

- [x] 2.2 FileTreeService実装（Green）
  - テストを通すための最小限のFileTreeService実装
  - プロジェクト情報取得とパス解決機能
  - ディレクトリ再帰読み取り機能
  - FileItem形式への変換機能
  - 基本的なエラーハンドリング
  - _要件: 1.1, 1.2_

- [x] 2.3 FileTreeServiceリファクタリング（Refactor）
  - パフォーマンス最適化（大量ファイル対応）
  - セキュリティ強化（パストラバーサル対策）
  - エラーメッセージの改善
  - ログ出力の追加
  - _要件: 1.1, 1.2_

- [x] 3. バックエンドAPIエンドポイントの実装（TDD）
- [x] 3.1 ファイルツリーAPIテスト作成（Red）
  - GET /api/projects/:id/files エンドポイントのテスト作成
  - 正常系レスポンス形式のテスト作成
  - エラーケース（404、400、403）のテスト作成
  - ApiResponse形式でのレスポンステスト作成
  - _要件: 1.1, 1.3, 1.4, 1.5_

- [x] 3.2 ファイルツリーAPI実装（Green）
  - テストを通すための最小限のAPIエンドポイント実装
  - FileTreeServiceとの統合
  - 既存のApiResponse形式でのレスポンス生成
  - 基本的なバリデーションとエラーハンドリング
  - _要件: 1.1, 1.2_

- [x] 3.3 ファイルツリーAPIリファクタリング（Refactor）
  - エラーハンドリングの統一
  - ログ出力の改善
  - パフォーマンス最適化
  - セキュリティ強化
  - _要件: 1.1, 1.2_

- [ ] 4. フロントエンドApiClient拡張（TDD）
- [ ] 4.1 ApiClientファイルツリーメソッドテスト作成（Red）
  - getProjectFilesメソッドのテスト作成
  - 正常系レスポンス処理のテスト作成
  - エラーハンドリングのテスト作成
  - 既存ApiClientとの統合テスト作成
  - _要件: 4.2, 4.3_

- [ ] 4.2 ApiClientファイルツリーメソッド実装（Green）
  - テストを通すための最小限のgetProjectFilesメソッド実装
  - 既存のAPIクライアント機構との統合
  - エラーハンドリングの実装
  - TypeScript型安全性の確保
  - _要件: 4.2, 4.3_

- [ ] 4.3 ApiClientファイルツリーメソッドリファクタリング（Refactor）
  - エラーメッセージの改善
  - パフォーマンス最適化
  - コードの整理と可読性向上
  - _要件: 4.2, 4.3_

- [ ] 5. FileTreeItemコンポーネントの実装（TDD）
- [ ] 5.1 FileTreeItemテスト作成（Red）
  - ファイル表示のテスト作成
  - フォルダ表示のテスト作成
  - 選択状態表示のテスト作成
  - 展開・折りたたみ機能のテスト作成
  - インデント表示のテスト作成
  - クリックイベント処理のテスト作成
  - _要件: 2.2, 2.3, 3.1, 3.2, 3.3_

- [ ] 5.2 FileTreeItem実装（Green）
  - テストを通すための最小限のFileTreeItemコンポーネント実装
  - ファイル/フォルダアイコン表示
  - 基本的な展開・折りたたみ機能
  - 選択状態のハイライト表示
  - クリックイベント処理
  - _要件: 2.2, 2.3, 3.1, 3.2, 3.3_

- [ ] 5.3 FileTreeItemリファクタリング（Refactor）
  - アクセシビリティ対応（ARIA属性、キーボード操作）
  - パフォーマンス最適化（React.memo）
  - アニメーション効果の追加
  - スタイリングの改善
  - _要件: 2.2, 2.3, 3.1, 3.2, 3.3_

- [ ] 6. FileTreeViewコンポーネントの実装（TDD）
- [ ] 6.1 FileTreeViewテスト作成（Red）
  - ファイルツリー表示のテスト作成
  - ローディング状態表示のテスト作成
  - エラー状態表示のテスト作成
  - ファイル選択機能のテスト作成
  - API呼び出し処理のテスト作成
  - _要件: 2.1, 2.4, 2.5, 3.4_

- [ ] 6.2 FileTreeView実装（Green）
  - テストを通すための最小限のFileTreeViewコンポーネント実装
  - ApiClientを使用したファイルツリー取得
  - ローディング・エラー状態管理
  - FileTreeItemコンポーネントとの統合
  - ファイル選択コールバック処理
  - _要件: 2.1, 2.4, 2.5, 3.4_

- [ ] 6.3 FileTreeViewリファクタリング（Refactor）
  - エラーハンドリングの改善
  - 再試行機能の追加
  - パフォーマンス最適化
  - ユーザビリティ向上
  - _要件: 2.1, 2.4, 2.5, 3.4_

- [ ] 7. ProjectSidebarとの統合（TDD）
- [ ] 7.1 ProjectSidebar統合テスト作成（Red）
  - FileTreeViewコンポーネント統合のテスト作成
  - プロジェクト選択時のファイルツリー表示テスト作成
  - ファイル選択時のコールバック処理テスト作成
  - 既存機能への影響確認テスト作成
  - _要件: 2.1, 3.4_

- [ ] 7.2 ProjectSidebar統合実装（Green）
  - テストを通すための最小限のProjectSidebar修正
  - 「ファイルツリー機能は実装予定です」メッセージの削除
  - FileTreeViewコンポーネントの統合
  - onFileSelectコールバックの実装
  - _要件: 2.1, 3.4_

- [ ] 7.3 ProjectSidebar統合リファクタリング（Refactor）
  - コンポーネント構造の最適化
  - 状態管理の改善
  - エラーハンドリングの統一
  - パフォーマンス最適化
  - _要件: 2.1, 3.4_

- [ ] 8. Dashboardとの統合（TDD）
- [ ] 8.1 Dashboard統合テスト作成（Red）
  - ファイル選択状態管理のテスト作成
  - ヘッダーファイル名表示のテスト作成
  - プロジェクト切り替え時のファイル選択クリアテスト作成
  - 既存機能への影響確認テスト作成
  - _要件: 3.4_

- [ ] 8.2 Dashboard統合実装（Green）
  - テストを通すための最小限のDashboard修正
  - ファイル選択状態の管理改善
  - ヘッダーでの選択ファイル名表示
  - プロジェクト切り替え時の状態クリア
  - _要件: 3.4_

- [ ] 8.3 Dashboard統合リファクタリング（Refactor）
  - 状態管理の最適化
  - コンポーネント間の結合度改善
  - TypeScript型安全性の強化
  - ユーザビリティ向上
  - _要件: 3.4_

- [ ] 9. MSWハンドラーの実装
  - ファイルツリーAPI用のMSWハンドラー作成
  - モックデータの作成（.kiroディレクトリ構造）
  - 開発環境でのテスト確認
  - エラーケースのモック実装
  - _要件: 4.2_

- [ ] 10. E2Eテストと統合テスト
  - Playwrightを使用したファイルツリー機能のE2Eテスト作成
  - プロジェクト選択からファイル選択までの統合テスト
  - エラーケースのE2Eテスト
  - パフォーマンステスト
  - _要件: 1.1, 2.1, 3.1, 4.4_

- [ ] 11. ドキュメント更新
  - README.mdにファイルツリー機能の説明追加
  - 技術ドキュメント（steering）の更新
  - APIドキュメントの更新
  - 使用方法の説明追加
  - _要件: 4.4_
