# 要件ドキュメント

## 概要

kiro-lensプロジェクトにおいて、現在バックエンドとフロントエンドで分散している型定義を`packages/shared`パッケージに統合し、型安全性と保守性を向上させる型定義統合システムを実装します。重複している型定義の解消、共通で使用される型の集約、各パッケージ固有の型の適切な配置を行い、TypeScriptの型システムを最大限活用した開発環境を構築します。

## 要件

### 要件1：重複型定義の解消

**ユーザーストーリー:** 開発者として、同じ目的の型が複数箇所で定義されている状況を解消し、単一の信頼できる型定義を使用したい。

#### 受け入れ基準

1. WHEN `ValidationResult`型を使用 THEN sharedパッケージの定義のみが使用され、バックエンドの重複定義が削除される
2. WHEN APIリクエスト・レスポンス型を使用 THEN 全てsharedパッケージから提供される統一された型定義が使用される
3. WHEN 型定義の変更が必要 THEN 単一箇所の変更で全体に反映される
4. WHEN TypeScriptコンパイル THEN 重複による型エラーが発生しない

### 要件2：共通型定義の集約

**ユーザーストーリー:** 開発者として、フロントエンドとバックエンドで共通して使用される型定義をsharedパッケージに集約し、型の一貫性を保ちたい。

#### 受け入れ基準

1. WHEN ファイルシステム関連の型を使用 THEN `DirectoryPermissions`などの共通型がsharedパッケージで定義される
2. WHEN APIエンドポイントのパラメータ型を使用 THEN 共通で使用されるパラメータ型がsharedパッケージで定義される
3. WHEN 新しい共通型が必要 THEN sharedパッケージに追加され、適切にエクスポートされる
4. WHEN 型定義を参照 THEN フロントエンドとバックエンドで同じ型定義が使用される

### 要件3：パッケージ固有型の適切な配置

**ユーザーストーリー:** 開発者として、各パッケージ固有の型定義は適切な場所に配置し、不要な依存関係を避けたい。

#### 受け入れ基準

1. WHEN フロントエンド固有の型を使用 THEN Reactコンポーネントのprops型などはフロントエンドパッケージ内に配置される
2. WHEN バックエンド固有の型を使用 THEN Fastify固有の型などはバックエンドパッケージ内に配置される
3. WHEN 環境変数型を使用 THEN 各パッケージの環境に応じた型定義が適切に配置される
4. WHEN パッケージ間の依存関係 THEN 不要な循環依存が発生しない

### 要件4：型安全性の向上とエラー防止

**ユーザーストーリー:** 開発者として、統合された型定義により、コンパイル時により多くのエラーを検出し、実行時エラーを防止したい。

#### 受け入れ基準

1. WHEN APIリクエスト・レスポンスを処理 THEN フロントエンドとバックエンドで型の不整合によるエラーが発生しない
2. WHEN 型定義を変更 THEN 影響を受ける全ての箇所でTypeScriptエラーが表示される
3. WHEN 新しい機能を追加 THEN 既存の型定義を再利用して型安全な実装が可能
4. WHEN リファクタリングを実行 THEN 型システムにより安全な変更が保証される

### 要件5：開発体験の向上

**ユーザーストーリー:** 開発者として、統合された型定義により、IDEの補完機能やドキュメント参照が向上し、開発効率を高めたい。

#### 受け入れ基準

1. WHEN 型定義を参照 THEN IDEで適切な型情報とドキュメントが表示される
2. WHEN インポート文を記述 THEN 統一されたインポートパスで型定義にアクセスできる
3. WHEN 型定義を検索 THEN 単一の場所で全ての共通型定義を確認できる
4. WHEN 新しい開発者がプロジェクトに参加 THEN 型定義の場所と使用方法が明確に理解できる
