# 要件ドキュメント

## 概要

Figma MCPから取得したUIデザインを基に、ローカルで実行可能なファイル管理・編集ダッシュボードを構築します。このツールは、プロジェクトのrootディレクトリでCLIコマンド（npx kiro-lens）を実行し、ローカルブラウザ（localhost:3000）でアクセス可能なWebアプリケーションとして動作します。ファイルの閲覧、編集、リアルタイム更新機能を提供し、開発者の生産性向上を目指します。

## 要件

### 要件1：プロジェクト初期化とCLI機能

**ユーザーストーリー:** 開発者として、プロジェクトのrootディレクトリで簡単なコマンドを実行して、ローカルでファイル管理ダッシュボードを起動したい。

#### 受け入れ基準

1. WHEN 開発者がプロジェクトのrootディレクトリで `npx kiro-lens` を実行 THEN システムはローカルサーバーを起動し、ブラウザでアクセス可能なURLを表示する
2. WHEN CLIコマンドが実行される THEN システムはViteフロントエンドサーバー（localhost:3000）とFastifyバックエンドサーバー（localhost:3001）を並行起動する
3. WHEN サーバーが正常に起動 THEN システムはコンソールにアクセスURL（http://localhost:3000）を表示する
4. WHEN ユーザーがCtrl+Cでプロセスを終了 THEN システムは両方のサーバーを適切にシャットダウンする

### 要件2：ファイルシステム統合とリアルタイム監視

**ユーザーストーリー:** 開発者として、プロジェクト内のファイル構造を視覚的に確認し、ローカルでファイルが変更された際に自動的にブラウザ側に反映されることを期待する。

#### 受け入れ基準

1. WHEN ダッシュボードが起動 THEN システムはプロジェクトのファイル構造を読み込み、サイドバーに階層表示する
2. WHEN ローカルでファイルが作成・削除・変更される THEN システムはchokidarを使用してファイル変更を検知し、WebSocket経由でブラウザに通知する
3. WHEN ファイル変更通知を受信 THEN ブラウザは自動的にファイル一覧とコンテンツを更新する
4. WHEN .mdファイルが選択される THEN システムはgray-matterを使用してフロントマターを解析し、適切にレンダリングする
5. WHEN 大きなファイルやバイナリファイルにアクセス THEN システムは適切なエラーハンドリングを行い、ユーザーに分かりやすいメッセージを表示する

### 要件3：Figma UIベースのダッシュボード実装

**ユーザーストーリー:** 開発者として、Figmaで設計されたUIと同じ見た目と操作感でファイル管理を行いたい。

#### 受け入れ基準

1. WHEN ダッシュボードにアクセス THEN システムはFigmaデザインと同じレイアウト（サイドバー、メインコンテンツ、タスクリスト）を表示する
2. WHEN サイドバーのフォルダをクリック THEN システムはフォルダの展開・折りたたみを行い、チェブロンアイコンの向きを変更する
3. WHEN ファイルを選択 THEN システムはメインコンテンツエリアにファイル内容を表示し、選択状態をハイライト表示する
4. WHEN .mdファイルを表示 THEN システムはMarkdownを適切にレンダリングし、日本語フォント（Noto Sans JP）で表示する
5. WHEN タスクリストのアイテムをクリック THEN システムは展開・折りたたみ機能を提供し、チェックボックスの状態を管理する

### 要件4：ファイル編集とリアルタイム同期

**ユーザーストーリー:** 開発者として、ブラウザ上でファイルを直接編集し、その変更がローカルファイルシステムに即座に反映されることを期待する。

#### 受け入れ基準

1. WHEN ファイルコンテンツエリアで編集モードを有効化 THEN システムはテキストエディタ機能を提供し、リアルタイムでプレビューを更新する
2. WHEN ブラウザでファイル内容を変更 THEN システムはAPI経由でローカルファイルシステムに変更を保存する
3. WHEN ファイル保存が完了 THEN システムはWebSocket経由で他の接続されたクライアントに変更を通知する
4. WHEN 複数のクライアントが同じファイルを編集 THEN システムは競合状態を検知し、適切な警告メッセージを表示する
5. WHEN ファイル編集中にローカルで同じファイルが変更される THEN システムは変更競合を検知し、ユーザーに選択肢（ローカル優先/ブラウザ優先/マージ）を提供する

### 要件5：TypeScript統一とパフォーマンス最適化

**ユーザーストーリー:** 開発者として、フロントエンドとバックエンドの両方でTypeScriptを使用し、型安全性を保ちながら高速な開発体験を得たい。

#### 受け入れ基準

1. WHEN プロジェクトをビルド THEN システムはフロントエンド（Vite + React）とバックエンド（Fastify）の両方でTypeScriptコンパイルエラーがないことを確認する
2. WHEN 共通の型定義を使用 THEN システムはsharedパッケージの型定義をフロントエンドとバックエンドで共有し、型安全性を保証する
3. WHEN 開発サーバーを起動 THEN システムはViteのHMR（Hot Module Replacement）機能により、フロントエンドの変更を即座に反映する
4. WHEN APIリクエストを送信 THEN システムはFastifyの高性能な処理により、レスポンス時間を最小化する
5. WHEN 大量のファイルを処理 THEN システムは仮想化やページネーション機能により、UIの応答性を維持する