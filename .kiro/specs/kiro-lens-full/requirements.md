# 要件ドキュメント

## 概要

AWS開発のKiro IDEで作成される.kiro配下のファイル（スペック、ステアリング、設定等）をブラウザ上で確認・編集できるローカル開発ツールを構築します。このツールは、プロジェクトのrootディレクトリでCLIコマンド（npx kiro-lens）を実行し、ローカルブラウザ（localhost:3000）でアクセス可能なWebアプリケーションとして動作します。Kiroプロジェクトの.kiroディレクトリ内のファイル管理、閲覧、編集、リアルタイム更新機能を提供し、Kiro IDE利用者の開発体験向上を目指します。

## 要件

### 要件1：プロジェクト初期化とCLI機能

**ユーザーストーリー:** Kiro IDE利用者として、プロジェクトのrootディレクトリで簡単なコマンドを実行して、.kiro配下のファイル管理ダッシュボードを起動したい。

#### 受け入れ基準

1. WHEN 開発者がプロジェクトのrootディレクトリで `npx kiro-lens` を実行 THEN システムはローカルサーバーを起動し、ブラウザでアクセス可能なURLを表示する
2. WHEN CLIコマンドが実行される THEN システムはViteフロントエンドサーバー（localhost:3000）とFastifyバックエンドサーバー（localhost:3001）を並行起動する
3. WHEN サーバーが正常に起動 THEN システムはコンソールにアクセスURL（http://localhost:3000）を表示する
4. WHEN ユーザーがCtrl+Cでプロセスを終了 THEN システムは両方のサーバーを適切にシャットダウンする

### 要件2：.kiroディレクトリ監視とリアルタイム更新

**ユーザーストーリー:** Kiro IDE利用者として、.kiro配下のファイル構造（specs、steering、settings等）を視覚的に確認し、ローカルでファイルが変更された際に自動的にブラウザ側に反映されることを期待する。

#### 受け入れ基準

1. WHEN ダッシュボードが起動 THEN システムは.kiroディレクトリのファイル構造を読み込み、サイドバーに階層表示する
2. WHEN .kiro配下でファイルが作成・削除・変更される THEN システムはchokidarを使用してファイル変更を検知し、WebSocket経由でブラウザに通知する
3. WHEN ファイル変更通知を受信 THEN ブラウザは自動的にファイル一覧とコンテンツを更新する
4. WHEN .mdファイル（requirements.md、design.md、tasks.md、steering/*.md等）が選択される THEN システムはgray-matterを使用してフロントマターを解析し、適切にレンダリングする
5. WHEN .jsonファイル（mcp.json、settings等）にアクセス THEN システムはJSON形式で適切にフォーマットして表示する

### 要件3：Kiro専用ダッシュボード実装

**ユーザーストーリー:** Kiro IDE利用者として、.kiro配下のファイル構造に特化した見やすいダッシュボードでファイル管理を行いたい。

#### 受け入れ基準

1. WHEN ダッシュボードにアクセス THEN システムは.kiro専用レイアウト（サイドバー、メインコンテンツ、タスクリスト）を表示する
2. WHEN サイドバーのフォルダ（specs、steering、settings等）をクリック THEN システムはフォルダの展開・折りたたみを行い、チェブロンアイコンの向きを変更する
3. WHEN ファイルを選択 THEN システムはメインコンテンツエリアにファイル内容を表示し、選択状態をハイライト表示する
4. WHEN .mdファイル（スペック、ステアリング等）を表示 THEN システムはMarkdownを適切にレンダリングし、日本語フォント（Noto Sans JP）で表示する
5. WHEN tasks.mdのタスクリストを表示 THEN システムはチェックボックス付きタスクの展開・折りたたみ機能を提供し、タスクの進捗状態を管理する

### 要件4：.kiroファイル編集とリアルタイム同期

**ユーザーストーリー:** Kiro IDE利用者として、ブラウザ上で.kiro配下のファイル（スペック、ステアリング、設定等）を直接編集し、その変更がローカルファイルシステムに即座に反映されることを期待する。

#### 受け入れ基準

1. WHEN .kiroファイルの編集モードを有効化 THEN システムはテキストエディタ機能を提供し、Markdownファイルの場合はリアルタイムでプレビューを更新する
2. WHEN ブラウザで.kiroファイル内容を変更 THEN システムはAPI経由でローカルファイルシステムに変更を保存する
3. WHEN ファイル保存が完了 THEN システムはWebSocket経由で他の接続されたクライアントに変更を通知する
4. WHEN 複数のクライアントが同じ.kiroファイルを編集 THEN システムは競合状態を検知し、適切な警告メッセージを表示する
5. WHEN ファイル編集中にKiro IDEで同じファイルが変更される THEN システムは変更競合を検知し、ユーザーに選択肢（ローカル優先/ブラウザ優先/マージ）を提供する

### 要件5：TypeScript統一とKiro特化最適化

**ユーザーストーリー:** Kiro IDE利用者として、フロントエンドとバックエンドの両方でTypeScriptを使用し、.kiro配下のファイル処理に特化した高速な開発体験を得たい。

#### 受け入れ基準

1. WHEN プロジェクトをビルド THEN システムはフロントエンド（Vite + React）とバックエンド（Fastify）の両方でTypeScriptコンパイルエラーがないことを確認する
2. WHEN 共通の型定義を使用 THEN システムはsharedパッケージの型定義をフロントエンドとバックエンドで共有し、Kiro特有のファイル構造に対する型安全性を保証する
3. WHEN 開発サーバーを起動 THEN システムはViteのHMR（Hot Module Replacement）機能により、フロントエンドの変更を即座に反映する
4. WHEN .kiro配下のAPIリクエストを送信 THEN システムはFastifyの高性能な処理により、レスポンス時間を最小化する
5. WHEN .kiro配下の大量のスペックファイルを処理 THEN システムは仮想化やページネーション機能により、UIの応答性を維持する