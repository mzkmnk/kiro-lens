# kiro-lens TDD実装計画

## 完了済みタスク

- [x] 1. プロジェクト初期セットアップとワークスペース構成
  - モノレポ構成でpackage.jsonワークスペース設定を作成
  - 各パッケージ（frontend、backend、shared）のディレクトリ構造とpackage.json設定
  - TypeScript設定ファイル（ルートとパッケージ別）の作成
  - _要件: 1.1, 1.2, 5.1_

- [ ] 2. Kiro専用共通型定義とインターフェース実装
  - shared パッケージで.kiroファイルシステム、API、WebSocket の型定義を作成
  - KiroFileTreeNode、KiroFileContent、Kiro API レスポンス型の実装
  - Kiro WebSocket イベント型とエラー型の定義
  - _要件: 5.2_

## TDD実装タスク

- [ ] 3. CLI エントリーポイント（TDD）
- [ ] 3.1 CLIテスト作成（Red）
  - Commander.js CLIコマンドの動作テスト作成
  - プロジェクトルート検出ロジックのテスト作成
  - サーバー起動・停止のテスト作成
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 3.2 CLI実装（Green）
  - テストを通すための最小限のCLI実装
  - Commander.js を使用したkiro-lensコマンド実装
  - concurrently による並行起動機能実装
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 3.3 CLIリファクタリング（Refactor）
  - コードの整理とエラーハンドリング改善
  - 設定ファイル読み込み機能の追加
  - ログ出力とユーザビリティ向上
  - _要件: 1.1, 1.2, 1.3, 1.4_
- [ ] 4. Fastify バックエンドサーバー基盤（TDD）
- [ ] 4.1 Fastifyサーバーテスト作成（Red）
  - Fastify サーバー起動・停止のテスト作成
  - CORS、WebSocket、静的ファイル配信のテスト作成
  - エラーハンドリングミドルウェアのテスト作成
  - _要件: 1.2, 5.4_

- [ ] 4.2 Fastifyサーバー実装（Green）
  - テストを通すための最小限のサーバー実装
  - プラグイン設定とミドルウェア実装
  - 基本的なヘルスチェックエンドポイント実装
  - _要件: 1.2, 5.4_

- [ ] 4.3 Fastifyサーバーリファクタリング（Refactor）
  - プラグイン構造の整理と設定の外部化
  - ログ設定とモニタリング機能追加
  - パフォーマンス最適化とセキュリティ強化
  - _要件: 1.2, 5.4_

- [ ] 5. .kiroファイルシステムAPI（TDD）
- [ ] 5.1 .kiroファイルAPIテスト作成（Red）
  - GET /api/kiro/files .kiroファイルツリー取得APIのテスト作成
  - GET /api/kiro/files/:path .kiroファイル内容取得APIのテスト作成
  - PUT /api/kiro/files/:path .kiroファイル更新APIのテスト作成
  - エラーケース（.kiroディレクトリ未存在、権限エラー等）のテスト作成
  - _要件: 2.1, 4.2_

- [ ] 5.2 .kiroファイルAPI実装（Green）
  - テストを通すための最小限の.kiro専用API実装
  - .kiroファイルシステム操作とレスポンス生成
  - 基本的なバリデーションとエラーハンドリング
  - _要件: 2.1, 4.2_

- [ ] 5.3 .kiroファイルAPIリファクタリング（Refactor）
  - サービス層の分離とKiro特化ビジネスロジック整理
  - パフォーマンス最適化（キャッシュ、ストリーミング）
  - セキュリティ強化（.kiro配下制限、パストラバーサル対策等）
  - _要件: 2.1, 4.2_

- [ ] 6. .kiro監視とWebSocket（TDD）
- [ ] 6.1 .kiro監視テスト作成（Red）
  - chokidar .kiroディレクトリ変更監視のテスト作成
  - WebSocket接続・切断のテスト作成
  - .kiroファイル変更イベント通知のテスト作成
  - 複数クライアント管理のテスト作成
  - _要件: 2.2, 2.3, 4.3_

- [ ] 6.2 .kiro監視実装（Green）
  - テストを通すための最小限の.kiro監視機能実装
  - WebSocketサーバーとクライアント管理実装
  - 基本的な.kiroイベント通知機能実装
  - _要件: 2.2, 2.3, 4.3_

- [ ] 6.3 .kiro監視リファクタリング（Refactor）
  - .kiro監視対象の最適化とパフォーマンス改善
  - WebSocket接続の安定性向上
  - メモリリーク対策とリソース管理改善
  - _要件: 2.2, 2.3, 4.3_

- [ ] 7. Vite + React フロントエンド基盤（TDD）
- [ ] 7.1 Viteプロジェクトテスト作成（Red）
  - Vite設定とReact環境のテスト作成
  - Tailwind CSS統合のテスト作成
  - 開発サーバーとプロキシ設定のテスト作成
  - _要件: 3.4, 5.3_

- [ ] 7.2 Viteプロジェクト実装（Green）
  - テストを通すための最小限のVite設定実装
  - React + TypeScript環境構築
  - 基本的なTailwind CSS設定実装
  - _要件: 3.4, 5.3_

- [ ] 7.3 Viteプロジェクトリファクタリング（Refactor）
  - ビルド最適化とバンドル設定改善
  - 開発体験向上（HMR、エラー表示等）
  - 本番ビルド設定とアセット最適化
  - _要件: 3.4, 5.3_

- [ ] 8. React Query と.kiro WebSocketクライアント（TDD）
- [ ] 8.1 .kiroクライアント状態管理テスト作成（Red）
  - React Query設定と.kiro API状態管理のテスト作成
  - Socket.ioクライアント接続のテスト作成
  - カスタムフック（useKiroFiles、useWebSocket、useKiroFileEditor）のテスト作成
  - _要件: 2.3, 4.3, 5.3_

- [ ] 8.2 .kiroクライアント状態管理実装（Green）
  - テストを通すための最小限のReact Query実装
  - .kiro WebSocketクライアント接続実装
  - 基本的な.kiro専用カスタムフック実装
  - _要件: 2.3, 4.3, 5.3_

- [ ] 8.3 .kiroクライアント状態管理リファクタリング（Refactor）
  - .kiroファイル特化キャッシュ戦略の最適化
  - エラーハンドリングと再接続ロジック改善
  - パフォーマンス最適化（メモ化、バッチング等）
  - _要件: 2.3, 4.3, 5.3_

- [ ] 9. Kiro Dashboard レイアウトコンポーネント（TDD）
- [ ] 9.1 Kiro Dashboardテスト作成（Red）
  - .kiro専用レイアウトのテスト作成
  - レスポンシブデザインのテスト作成
  - プロジェクト名・Kiro情報表示のテスト作成
  - _要件: 3.1, 3.4_

- [ ] 9.2 Kiro Dashboard実装（Green）
  - テストを通すための最小限の.kiro専用レイアウト実装
  - 基本的なサイドバー・メインコンテンツ構造実装
  - プロジェクト情報とKiro情報表示機能実装
  - _要件: 3.1, 3.4_

- [ ] 9.3 Kiro Dashboardリファクタリング（Refactor）
  - .kiro専用レイアウトの最適化とアクセシビリティ改善
  - パフォーマンス最適化（レンダリング、メモ化）
  - Kiroデザインシステムの統一とコンポーネント分離
  - _要件: 3.1, 3.4_

- [ ] 10. Sidebar .kiroファイルツリーコンポーネント（TDD）
- [ ] 10.1 .kiro Sidebarテスト作成（Red）
  - .kiro階層ファイル構造表示のテスト作成
  - specs、steering、settings フォルダ展開・折りたたみ機能のテスト作成
  - .kiroファイル選択とハイライト表示のテスト作成
  - _要件: 2.1, 3.2, 3.3_

- [ ] 10.2 .kiro Sidebar実装（Green）
  - テストを通すための最小限の.kiroファイルツリー実装
  - 基本的な展開・折りたたみ機能実装
  - .kiroファイル選択状態管理実装
  - _要件: 2.1, 3.2, 3.3_

- [ ] 10.3 .kiro Sidebarリファクタリング（Refactor）
  - 仮想化による大量.kiroファイル対応
  - キーボードナビゲーション対応
  - Kiro専用アイコン表示とビジュアル改善
  - _要件: 2.1, 3.2, 3.3_

- [ ] 11. MainContent .kiroファイル表示・編集コンポーネント（TDD）
- [ ] 11.1 .kiro MainContentテスト作成（Red）
  - .kiroファイル内容表示のテスト作成
  - Kiro Markdownレンダリング（フロントマター対応）のテスト作成
  - .kiroファイルインライン編集機能のテスト作成
  - _要件: 3.3, 3.4, 4.1_

- [ ] 11.2 .kiro MainContent実装（Green）
  - テストを通すための最小限の.kiroファイル表示実装
  - 基本的なKiro Markdownレンダリング実装
  - シンプルな.kiroファイルテキスト編集機能実装
  - _要件: 3.3, 3.4, 4.1_

- [ ] 11.3 .kiro MainContentリファクタリング（Refactor）
  - .kiroファイル専用エディタ機能の強化（シンタックスハイライト等）
  - リアルタイムプレビューの最適化
  - 日本語フォント適用とKiroスタイリング改善
  - _要件: 3.3, 3.4, 4.1_

- [ ] 12. Kiro TaskList コンポーネント（TDD）
- [ ] 12.1 Kiro TaskListテスト作成（Red）
  - tasks.mdタスクアイテム表示のテスト作成
  - Kiroタスク展開・折りたたみ機能のテスト作成
  - チェックボックス状態管理のテスト作成
  - _要件: 3.5_

- [ ] 12.2 Kiro TaskList実装（Green）
  - テストを通すための最小限のKiroタスクリスト実装
  - 基本的なチェックボックス機能実装
  - Kiroタスク項目クリックイベント実装
  - _要件: 3.5_

- [ ] 12.3 Kiro TaskListリファクタリング（Refactor）
  - Kiroタスク階層表示の最適化
  - 進捗表示とビジュアル改善
  - キーボードショートカット対応
  - _要件: 3.5_

- [ ] 13. .kiroファイル編集機能（TDD）
- [ ] 13.1 .kiroファイル編集テスト作成（Red）
  - .kiro専用テキストエディタ統合のテスト作成
  - .kiroファイル編集モード切り替えのテスト作成
  - .kiroファイル保存とAPI連携のテスト作成
  - _要件: 4.1, 4.2_

- [ ] 13.2 .kiroファイル編集実装（Green）
  - テストを通すための最小限の.kiroエディタ実装
  - 基本的な.kiroファイル編集・保存機能実装
  - .kiro API連携とデータ同期実装
  - _要件: 4.1, 4.2_

- [ ] 13.3 .kiroファイル編集リファクタリング（Refactor）
  - .kiroファイル専用エディタ機能の強化（Monaco Editor統合等）
  - パフォーマンス最適化とメモリ管理
  - ユーザビリティ改善（ショートカット、オートセーブ等）
  - _要件: 4.1, 4.2_

- [ ] 14. .kiroファイル競合検出と解決機能（TDD）
- [ ] 14.1 .kiroファイル競合検出テスト作成（Red）
  - 複数クライアント間.kiroファイル競合検出のテスト作成
  - Kiro IDEとブラウザ間ファイル変更競合検出のテスト作成
  - .kiroファイル競合解決UIのテスト作成
  - _要件: 4.4, 4.5_

- [ ] 14.2 .kiroファイル競合検出実装（Green）
  - テストを通すための最小限の.kiroファイル競合検出実装
  - 基本的な競合解決UI実装
  - 競合通知とユーザー選択機能実装
  - _要件: 4.4, 4.5_

- [ ] 14.3 .kiroファイル競合検出リファクタリング（Refactor）
  - .kiroファイル競合検出アルゴリズムの最適化
  - 高度な競合解決オプション追加
  - ユーザー体験の向上とエラー防止
  - _要件: 4.4, 4.5_

- [ ] 15. .kiroファイルエラーハンドリング（TDD）
- [ ] 15.1 .kiroファイルエラーハンドリングテスト作成（Red）
  - .kiroディレクトリアクセスエラーのテスト作成
  - .kiroファイルアクセスエラーのテスト作成
  - ネットワークエラーのテスト作成
  - WebSocket再接続のテスト作成
  - _要件: 2.5, 4.4_

- [ ] 15.2 .kiroファイルエラーハンドリング実装（Green）
  - テストを通すための最小限の.kiroエラー処理実装
  - 基本的なエラーメッセージ表示実装
  - 再接続・リトライ機能実装
  - _要件: 2.5, 4.4_

- [ ] 15.3 .kiroファイルエラーハンドリングリファクタリング（Refactor）
  - Kiro利用者向けユーザーフレンドリーなエラーメッセージ改善
  - 自動復旧機能の強化
  - ログ収集とデバッグ機能追加
  - _要件: 2.5, 4.4_

- [ ] 16. .kiroファイル特化パフォーマンス最適化（TDD）
- [ ] 16.1 .kiroパフォーマンステスト作成（Red）
  - 大量.kiroファイル表示のパフォーマンステスト作成
  - .kiroファイルレンダリング最適化のテスト作成
  - メモリ使用量のテスト作成
  - _要件: 5.5_

- [ ] 16.2 .kiroパフォーマンス最適化実装（Green）
  - テストを通すための最小限の.kiro最適化実装
  - 基本的な仮想化機能実装
  - .kiroファイルメモ化とキャッシュ機能実装
  - _要件: 5.5_

- [ ] 16.3 .kiroパフォーマンス最適化リファクタリング（Refactor）
  - 高度な仮想化（React Window）実装
  - 包括的な.kiroファイルメモ化戦略適用
  - メモリリーク対策とガベージコレクション最適化
  - _要件: 5.5_

- [ ] 17. .kiro E2Eテストと統合テスト（TDD）
- [ ] 17.1 .kiro E2Eテスト作成（Red）
  - Playwrightを使用した.kiro E2Eテストシナリオ作成
  - .kiroファイル編集フロー全体のテスト作成
  - CLI起動からブラウザアクセスまでの統合テスト作成
  - _要件: 1.1, 1.2, 1.3, 2.2, 2.3, 4.1, 4.2_

- [ ] 17.2 .kiro E2Eテスト実装（Green）
  - テストを通すための.kiro統合機能実装
  - エンドツーエンドフローの動作確認
  - 基本的なKiro利用者シナリオの実装
  - _要件: 1.1, 1.2, 1.3, 2.2, 2.3, 4.1, 4.2_

- [ ] 17.3 .kiro E2Eテストリファクタリング（Refactor）
  - テストの安定性向上とフレーク対策
  - 包括的な.kiroテストカバレッジ確保
  - CI/CD統合とテスト自動化
  - _要件: 1.1, 1.2, 1.3, 2.2, 2.3, 4.1, 4.2_

- [ ] 18. 本番ビルドとデプロイメント準備
- [ ] 18.1 本番ビルドテスト作成（Red）
  - 本番用ビルド設定のテスト作成
  - アセット最適化のテスト作成
  - CLIパッケージングのテスト作成
  - _要件: 1.1, 1.3_

- [ ] 18.2 本番ビルド実装（Green）
  - テストを通すための最小限のビルド設定実装
  - 基本的なアセット最適化実装
  - CLIパッケージング機能実装
  - _要件: 1.1, 1.3_

- [ ] 18.3 本番ビルドリファクタリング（Refactor）
  - ビルド最適化とバンドルサイズ削減
  - pnpm publish準備とドキュメント作成
  - ユーザーガイドとREADME.md完成
  - _要件: 1.1, 1.3_
