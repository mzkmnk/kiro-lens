# 要件ドキュメント

## 概要

kiro-lens-foundationは、Kiro IDEの.kiro配下ファイル管理ツール「kiro-lens」の基盤となるスペックです。CLI起動機能、基本的なサーバー構成、最小限のUI表示機能を実装し、後続スペックの土台となる動作する最小限のシステムを構築します。デフォルトでランダムポートを使用し、複数プロジェクトでの同時起動をサポートします。

## 要件

### 要件1：CLI起動とポート管理機能

**ユーザーストーリー:** Kiro IDE利用者として、プロジェクトのrootディレクトリで簡単なコマンドを実行して、ポート競合を気にせずに.kiroファイル管理ダッシュボードを起動したい。

#### 受け入れ基準

1. WHEN 開発者がプロジェクトのrootディレクトリで `npx kiro-lens` を実行 THEN システムは利用可能なランダムポートを自動検出してフロントエンドとバックエンドサーバーを起動する
2. WHEN ユーザーが `npx kiro-lens --port 3000` を実行 THEN システムはフロントエンド3000、バックエンド3001での起動を試行する
3. WHEN 指定ポートが既に使用中 THEN システムは警告メッセージを表示し、代替の利用可能ポートを自動検出して起動する
4. WHEN サーバー起動が完了 THEN システムはコンソールにフロントエンドURL（例：http://localhost:8247）とバックエンドURL（例：http://localhost:8248）を明確に表示する
5. WHEN ユーザーがCtrl+Cでプロセスを終了 THEN システムは両方のサーバーを適切にシャットダウンする

### 要件2：基本的なサーバー構成

**ユーザーストーリー:** 開発者として、TypeScriptベースのモノレポ構成で、フロントエンドとバックエンドが適切に分離された基盤システムを利用したい。

#### 受け入れ基準

1. WHEN プロジェクトをビルド THEN システムはフロントエンド（Vite + React）とバックエンド（Fastify）の両方でTypeScriptコンパイルエラーがないことを確認する
2. WHEN 開発サーバーを起動 THEN システムはViteのHMR（Hot Module Replacement）機能により、フロントエンドの変更を即座に反映する
3. WHEN バックエンドサーバーが起動 THEN システムはFastifyサーバーが指定ポートでHTTPリクエストを受け付ける状態になる
4. WHEN フロントエンドからバックエンドにAPIリクエストを送信 THEN システムは適切なCORS設定により通信を許可する
5. WHEN サーバーにヘルスチェックリクエストを送信 THEN システムは正常な応答（200 OK）を返す

### 要件3：最小限のUI表示機能

**ユーザーストーリー:** Kiro IDE利用者として、ブラウザでダッシュボードにアクセスし、基本的なレイアウトとプロジェクト情報を確認したい。

#### 受け入れ基準

1. WHEN ブラウザでフロントエンドURLにアクセス THEN システムは基本的なダッシュボードレイアウト（ヘッダー、サイドバー、メインコンテンツ）を表示する
2. WHEN ダッシュボードが読み込まれる THEN システムは現在のプロジェクト名を表示する
3. WHEN .kiroディレクトリが存在する THEN システムはサイドバーに「.kiro」フォルダアイコンを表示する
4. WHEN .kiroディレクトリが存在しない THEN システムはメインコンテンツエリアに「.kiroディレクトリが見つかりません」メッセージを表示する
5. WHEN サーバー接続が正常 THEN システムは接続状態インジケーター（緑色の✅）を表示する

### 要件4：共通型定義とアーキテクチャ基盤

**ユーザーストーリー:** 開発者として、フロントエンドとバックエンドで共通の型定義を使用し、型安全性を保ちながら開発を進めたい。

#### 受け入れ基準

1. WHEN sharedパッケージで型定義を作成 THEN システムはフロントエンドとバックエンドの両方から同じ型定義をインポートできる
2. WHEN API通信の型を定義 THEN システムはリクエスト・レスポンスの型安全性を保証する
3. WHEN ポート設定の型を定義 THEN システムはCLI引数とサーバー設定の型整合性を保証する
4. WHEN エラー型を定義 THEN システムは統一されたエラーハンドリング形式を提供する
5. WHEN ビルド時に型チェックを実行 THEN システムは型エラーがある場合にビルドを失敗させる

### 要件5：複数プロジェクト同時起動サポート

**ユーザーストーリー:** Kiro IDE利用者として、複数のプロジェクトで同時にkiro-lensを起動し、それぞれ独立して動作させたい。

#### 受け入れ基準

1. WHEN 複数のプロジェクトディレクトリで同時に `npx kiro-lens` を実行 THEN システムは各プロジェクトで異なるポートを自動割り当てして起動する
2. WHEN 一つのプロジェクトでkiro-lensが既に起動中 THEN システムは他のプロジェクトでの起動時にポート競合を回避する
3. WHEN ユーザーが特定のポートを指定して競合が発生 THEN システムは明確なエラーメッセージと代替案を提示する
4. WHEN 各プロジェクトのkiro-lensが起動 THEN システムは各プロジェクトのダッシュボードが独立して動作することを保証する
5. WHEN 一つのプロジェクトのkiro-lensを終了 THEN システムは他のプロジェクトのkiro-lensに影響を与えない