# kiro-lens-foundation TDD実装計画

## 概要

このタスクリストは、kiro-lens-foundationスペックの実装計画です。基盤となるCLI機能、サーバー構成、最小限のUI表示機能をTDD（テスト駆動開発）で実装し、後続スペックの土台となる動作する最小限のシステムを構築します。

## 完了済みタスク

- [x] 1. プロジェクト初期セットアップ
  - モノレポ構成でpackage.jsonワークスペース設定を作成
  - 各パッケージ（frontend、backend、shared）のディレクトリ構造とpackage.json設定
  - TypeScript設定ファイル（ルートとパッケージ別）の作成
  - _要件: 2.1, 4.1_

## TDD実装タスク

- [ ] 2. 共通型定義とポート管理型（TDD）

- [ ] 2.1 ポート設定型テスト作成（Red）
  - PortConfiguration、CLIOptions、PortValidationResult型のテスト作成
  - 型安全性とバリデーション機能のテスト作成
  - エラー型（FoundationErrorType）のテスト作成
  - _要件: 4.1, 4.2, 1.3_

- [ ] 2.2 共通型定義実装（Green）
  - テストを通すための最小限の型定義実装
  - shared パッケージでポート、ヘルスチェック、API の型定義を作成
  - 基本的なバリデーション関数実装
  - _要件: 4.1, 4.2, 1.3_

- [ ] 2.3 型定義リファクタリング（Refactor）
  - 型定義の整理とドキュメント追加
  - エクスポート構造の最適化
  - 型安全性の強化
  - _要件: 4.1, 4.2, 1.3_

- [ ] 3. ポート管理システム（TDD）

- [ ] 3.1 ポート検出テスト作成（Red）
  - 利用可能ポート検出機能のテスト作成
  - ポート競合検出のテスト作成
  - ランダムポート割り当てのテスト作成
  - 複数プロジェクト同時起動のテスト作成
  - _要件: 1.1, 1.3, 5.1, 5.2_

- [ ] 3.2 ポート管理実装（Green）
  - テストを通すための最小限のPortManager実装
  - 基本的なポート検出アルゴリズム実装
  - ポート競合時の代替ポート提案機能実装
  - _要件: 1.1, 1.3, 5.1, 5.2_

- [ ] 3.3 ポート管理リファクタリング（Refactor）
  - ポート検出アルゴリズムの最適化
  - エラーハンドリングの改善
  - パフォーマンス最適化
  - _要件: 1.1, 1.3, 5.1, 5.2_

- [ ] 4. CLI エントリーポイント（TDD）

- [ ] 4.1 CLIテスト作成（Red）
  - Commander.js CLIコマンドの動作テスト作成
  - コマンドライン引数解析のテスト作成
  - ヘルプメッセージとバージョン表示のテスト作成
  - _要件: 1.1, 1.2, 1.4_

- [ ] 4.2 CLI実装（Green）
  - テストを通すための最小限のCLI実装
  - Commander.js を使用したkiro-lensコマンド実装
  - 基本的なオプション解析機能実装
  - _要件: 1.1, 1.2, 1.4_

- [ ] 4.3 CLIリファクタリング（Refactor）
  - コマンドライン引数の検証強化
  - ユーザビリティ向上（ヘルプ、エラーメッセージ）
  - ログ出力の改善
  - _要件: 1.1, 1.2, 1.4_

- [ ] 5. Fastify バックエンドサーバー基盤（TDD）

- [ ] 5.1 Fastifyサーバーテスト作成（Red）
  - Fastify サーバー起動・停止のテスト作成
  - CORS設定のテスト作成
  - 基本的なエラーハンドリングのテスト作成
  - 指定ポートでの起動テスト作成
  - _要件: 2.3, 2.4, 2.5_

- [ ] 5.2 Fastifyサーバー実装（Green）
  - テストを通すための最小限のサーバー実装
  - 基本的なFastify設定とプラグイン実装
  - CORS設定実装
  - _要件: 2.3, 2.4, 2.5_

- [ ] 5.3 Fastifyサーバーリファクタリング（Refactor）
  - サーバー設定の外部化
  - ログ設定とエラーハンドリング改善
  - プラグイン構造の整理
  - _要件: 2.3, 2.4, 2.5_

- [ ] 6. ヘルスチェックAPI（TDD）

- [ ] 6.1 ヘルスチェックAPIテスト作成（Red）
  - GET /api/health エンドポイントのテスト作成
  - HealthResponse型のレスポンステスト作成
  - サーバー状態確認機能のテスト作成
  - _要件: 2.5, 3.5_

- [ ] 6.2 ヘルスチェックAPI実装（Green）
  - テストを通すための最小限のヘルスチェック実装
  - 基本的なサーバー状態レスポンス実装
  - アップタイム計測機能実装
  - _要件: 2.5, 3.5_

- [ ] 6.3 ヘルスチェックAPIリファクタリング（Refactor）
  - ヘルスチェック項目の拡張
  - レスポンス形式の最適化
  - パフォーマンス監視機能追加
  - _要件: 2.5, 3.5_

- [ ] 7. プロジェクト情報API（TDD）

- [ ] 7.1 プロジェクト情報APIテスト作成（Red）
  - GET /api/project エンドポイントのテスト作成
  - .kiroディレクトリ検出のテスト作成
  - プロジェクト名取得のテスト作成
  - _要件: 3.2, 3.4_

- [ ] 7.2 プロジェクト情報API実装（Green）
  - テストを通すための最小限のプロジェクト情報実装
  - .kiroディレクトリ存在確認機能実装
  - 基本的なプロジェクト情報レスポンス実装
  - _要件: 3.2, 3.4_

- [ ] 7.3 プロジェクト情報APIリファクタリング（Refactor）
  - プロジェクト情報の詳細化
  - エラーハンドリングの改善
  - キャッシュ機能の追加
  - _要件: 3.2, 3.4_

- [ ] 8. Vite + React フロントエンド基盤（TDD）

- [ ] 8.1 Viteプロジェクトテスト作成（Red）
  - Vite設定とReact環境のテスト作成
  - Tailwind CSS v4統合のテスト作成
  - 開発サーバー起動のテスト作成
  - _要件: 2.2, 3.1_

- [ ] 8.2 Viteプロジェクト実装（Green）
  - テストを通すための最小限のVite設定実装
  - React + TypeScript環境構築
  - 基本的なTailwind CSS v4設定実装
  - _要件: 2.2, 3.1_

- [ ] 8.3 Viteプロジェクトリファクタリング（Refactor）
  - ビルド設定の最適化
  - 開発体験向上（HMR、エラー表示等）
  - アセット管理の改善
  - _要件: 2.2, 3.1_

- [ ] 8.5. Tailwind CSS v4 + shadcn/ui セットアップ（TDD）

- [ ] 8.5.1 Tailwind CSS v4セットアップテスト作成（Red）
  - Tailwind CSS v4設定ファイルのテスト作成
  - 日本語フォント（Noto Sans JP）統合のテスト作成
  - カスタムテーマ設定のテスト作成
  - _要件: 2.2, 3.1_

- [ ] 8.5.2 Tailwind CSS v4セットアップ実装（Green）
  - テストを通すための最小限のTailwind CSS v4設定実装
  - 基本的なカスタムテーマ設定実装
  - 日本語フォント設定実装
  - _要件: 2.2, 3.1_

- [ ] 8.5.3 shadcn/uiセットアップテスト作成（Red）
  - shadcn/ui初期化のテスト作成
  - 基本コンポーネント（Button、Card、Badge等）のテスト作成
  - コンポーネントライブラリ統合のテスト作成
  - _要件: 2.2, 3.1_

- [ ] 8.5.4 shadcn/uiセットアップ実装（Green）
  - テストを通すための最小限のshadcn/ui設定実装
  - 基本コンポーネントのインストールと設定実装
  - TypeScript型定義の統合実装
  - _要件: 2.2, 3.1_

- [ ] 8.5.5 UI設定リファクタリング（Refactor）
  - Tailwind CSS v4とshadcn/uiの統合最適化
  - カスタムテーマとコンポーネントの一貫性確保
  - アクセシビリティ設定の強化
  - _要件: 2.2, 3.1_

- [ ] 9. 基本API通信とヘルスチェック（TDD）

- [ ] 9.1 API通信テスト作成（Red）
  - fetch APIラッパーのテスト作成
  - ヘルスチェック通信のテスト作成
  - useHealthカスタムフックのテスト作成
  - _要件: 2.4, 3.5_

- [ ] 9.2 API通信実装（Green）
  - テストを通すための最小限のAPI通信実装
  - 基本的なfetch APIラッパー実装
  - useHealthフック実装
  - _要件: 2.4, 3.5_

- [ ] 9.3 API通信リファクタリング（Refactor）
  - エラーハンドリングの改善
  - リトライ機能の追加
  - 型安全性の強化
  - _要件: 2.4, 3.5_

- [ ] 10. Dashboard レイアウトコンポーネント（TDD）

- [ ] 10.1 Dashboardテスト作成（Red）
  - 基本レイアウト構造のテスト作成
  - プロジェクト名表示のテスト作成
  - レスポンシブデザインのテスト作成
  - _要件: 3.1, 3.2_

- [ ] 10.2 Dashboard実装（Green）
  - テストを通すための最小限のレイアウト実装
  - 基本的なヘッダー・サイドバー・メインコンテンツ構造実装
  - プロジェクト名表示機能実装
  - _要件: 3.1, 3.2_

- [ ] 10.3 Dashboardリファクタリング（Refactor）
  - レイアウトの最適化
  - アクセシビリティ改善
  - スタイリングの統一
  - _要件: 3.1, 3.2_

- [ ] 11. Header コンポーネント（TDD）

- [ ] 11.1 Headerテスト作成（Red）
  - プロジェクト名表示のテスト作成
  - 接続状態インジケーターのテスト作成
  - ヘッダーレイアウトのテスト作成
  - _要件: 3.2, 3.5_

- [ ] 11.2 Header実装（Green）
  - テストを通すための最小限のヘッダー実装
  - プロジェクト名とステータス表示実装
  - 基本的なスタイリング実装
  - _要件: 3.2, 3.5_

- [ ] 11.3 Headerリファクタリング（Refactor）
  - ビジュアルデザインの改善
  - インタラクティブ要素の追加
  - アニメーション効果の実装
  - _要件: 3.2, 3.5_

- [ ] 12. Sidebar コンポーネント（TDD）

- [ ] 12.1 Sidebarテスト作成（Red）
  - .kiroディレクトリ表示のテスト作成
  - ディレクトリ未存在時のメッセージ表示テスト作成
  - サイドバーレイアウトのテスト作成
  - _要件: 3.3, 3.4_

- [ ] 12.2 Sidebar実装（Green）
  - テストを通すための最小限のサイドバー実装
  - .kiroディレクトリ存在確認と表示実装
  - 基本的なファイルアイコン表示実装
  - _要件: 3.3, 3.4_

- [ ] 12.3 Sidebarリファクタリング（Refactor）
  - ビジュアルデザインの改善
  - アイコンとスタイリングの統一
  - 将来の拡張性を考慮した構造改善
  - _要件: 3.3, 3.4_

- [ ] 13. MainContent コンポーネント（TDD）

- [ ] 13.1 MainContentテスト作成（Red）
  - 基本コンテンツ表示のテスト作成
  - ウェルカムメッセージ表示のテスト作成
  - .kiroディレクトリ未存在時のメッセージテスト作成
  - _要件: 3.1, 3.4_

- [ ] 13.2 MainContent実装（Green）
  - テストを通すための最小限のメインコンテンツ実装
  - 基本的なウェルカムメッセージ表示実装
  - 条件分岐による表示切り替え実装
  - _要件: 3.1, 3.4_

- [ ] 13.3 MainContentリファクタリング（Refactor）
  - コンテンツレイアウトの改善
  - 情報表示の充実
  - 将来の機能拡張を考慮した構造改善
  - _要件: 3.1, 3.4_

- [ ] 14. サーバー起動統合機能（TDD）

- [ ] 14.1 サーバー起動統合テスト作成（Red）
  - CLI実行からサーバー起動までの統合テスト作成
  - concurrently による並行起動のテスト作成
  - プロセス終了処理のテスト作成
  - _要件: 1.1, 1.5, 2.3_

- [ ] 14.2 サーバー起動統合実装（Green）
  - テストを通すための最小限の統合機能実装
  - concurrently を使用した並行起動実装
  - 基本的なプロセス管理実装
  - _要件: 1.1, 1.5, 2.3_

- [ ] 14.3 サーバー起動統合リファクタリング（Refactor）
  - 起動プロセスの最適化
  - エラーハンドリングの改善
  - ログ出力とユーザビリティ向上
  - _要件: 1.1, 1.5, 2.3_

- [ ] 15. エラーハンドリングとログ機能（TDD）

- [ ] 15.1 エラーハンドリングテスト作成（Red）
  - FoundationError型のテスト作成
  - ポート競合エラーハンドリングのテスト作成
  - ユーザーフレンドリーなエラーメッセージのテスト作成
  - _要件: 1.3, 5.3_

- [ ] 15.2 エラーハンドリング実装（Green）
  - テストを通すための最小限のエラー処理実装
  - 基本的なエラーメッセージ表示実装
  - ログ出力機能実装
  - _要件: 1.3, 5.3_

- [ ] 15.3 エラーハンドリングリファクタリング（Refactor）
  - エラーメッセージの改善
  - 復旧手順の提案機能追加
  - ログレベルとフォーマットの最適化
  - _要件: 1.3, 5.3_

- [ ] 16. 統合テストとE2E検証（TDD）

- [ ] 16.1 統合テスト作成（Red）
  - CLI実行からブラウザアクセスまでのE2Eテスト作成
  - 複数プロジェクト同時起動のテスト作成
  - ポート指定オプションの動作テスト作成
  - _要件: 1.1, 1.2, 5.1, 5.4_

- [ ] 16.2 統合テスト実装（Green）
  - テストを通すための統合機能実装
  - エンドツーエンドフローの動作確認
  - 基本的なユーザーシナリオの実装
  - _要件: 1.1, 1.2, 5.1, 5.4_

- [ ] 16.3 統合テストリファクタリング（Refactor）
  - テストの安定性向上
  - 包括的なテストカバレッジ確保
  - CI/CD統合準備
  - _要件: 1.1, 1.2, 5.1, 5.4_

- [ ] 17. ドキュメントとREADME作成

- [ ] 17.1 基本ドキュメント作成
  - README.md作成（インストール、使用方法）
  - CLI使用方法のドキュメント作成
  - トラブルシューティングガイド作成
  - _要件: 1.1, 1.2, 1.3_

- [ ] 17.2 開発者向けドキュメント作成
  - 開発環境セットアップガイド作成
  - アーキテクチャ概要ドキュメント作成
  - 次のスペック（kiro-lens-core-api）への接続ガイド作成
  - _要件: 2.1, 4.5_

- [ ] 17.3 ユーザーガイド作成
  - 基本的な使用方法ガイド作成
  - よくある質問（FAQ）作成
  - コミュニティ貢献ガイド作成
  - _要件: 1.1, 5.1_

## 完了基準

このスペックは以下の条件を満たした時点で完了とします：

### 機能的完了基準

- ✅ `npx kiro-lens` でランダムポートでサーバーが起動する
- ✅ `npx kiro-lens --port 3000` で指定ポートでサーバーが起動する
- ✅ ブラウザでダッシュボードにアクセスできる
- ✅ プロジェクト名と.kiroディレクトリ状態が表示される
- ✅ ヘルスチェックAPIが正常に動作する
- ✅ 複数プロジェクトで同時起動できる

### 技術的完了基準

- ✅ 全てのテストが通過する
- ✅ TypeScriptコンパイルエラーがない
- ✅ ESLintエラーがない
- ✅ 基本的なドキュメントが整備されている

### 品質基準

- ✅ テストカバレッジ80%以上
- ✅ 起動時間5秒以内
- ✅ メモリ使用量100MB以内
- ✅ 基本的なアクセシビリティ要件を満たす
