# kiro-lens-foundation TDD実装計画

## 概要

このタスクリストは、kiro-lens-foundationスペックの実装計画です。基盤となるCLI機能、サーバー構成、最小限のUI表示機能をTDD（テスト駆動開発）で実装し、後続スペックの土台となる動作する最小限のシステムを構築します。

## 完了済みタスク

- [x] 1. プロジェクト初期セットアップ
  - モノレポ構成でpackage.jsonワークスペース設定を作成
  - 各パッケージ（frontend、backend、shared）のディレクトリ構造とpackage.json設定
  - TypeScript設定ファイル（ルートとパッケージ別）の作成
  - _要件: 2.1, 4.1_

## TDD実装タスク

- [x] 2. 共通型定義とポート管理型（TDD）

- [x] 2.1 ポート設定型テスト作成（Red）
  - PortConfiguration、CLIOptions、PortValidationResult型のテスト作成
  - 型安全性とバリデーション機能のテスト作成
  - エラー型（FoundationErrorType）のテスト作成
  - _要件: 4.1, 4.2, 1.3_

- [x] 2.2 共通型定義実装（Green）
  - テストを通すための最小限の型定義実装
  - shared パッケージでポート、ヘルスチェック、API の型定義を作成
  - 基本的なバリデーション関数実装
  - _要件: 4.1, 4.2, 1.3_

- [x] 2.3 型定義リファクタリング（Refactor）
  - 型定義の整理とドキュメント追加
  - エクスポート構造の最適化
  - 型安全性の強化
  - _要件: 4.1, 4.2, 1.3_

- [x] 3. 基本ポート管理システム（TDD）

- [x] 3.1 基本ポート管理テスト作成（Red）
  - 固定ポート設定機能のテスト作成
  - ポート設定バリデーション（範囲チェック等）のテスト作成
  - 基本的なPortManagerクラスのテスト作成
  - CLIオプションからのポート設定のテスト作成
  - _要件: 1.1, 1.2, 4.1_
  - **注記**: 既存実装（packages/shared/src/utils/portUtils.ts）で完了済み

- [x] 3.2 基本ポート管理実装（Green）
  - テストを通すための最小限のPortManager実装
  - 固定ポート設定機能実装
  - 基本的なポート番号バリデーション実装
  - CLIオプション解析との連携実装
  - _要件: 1.1, 1.2, 4.1_
  - **注記**: 既存実装（packages/shared/src/utils/portUtils.ts）で完了済み

- [x] 3.3 基本ポート管理リファクタリング（Refactor）
  - ポート設定の外部化
  - エラーメッセージの改善
  - 設定の型安全性強化
  - _要件: 1.1, 1.2, 4.1_
  - **注記**: 既存実装（packages/shared/src/utils/portUtils.ts）で完了済み

- [-] 4. CLI エントリーポイント（TDD）

- [x] 4.1 CLI基本構造テスト作成（Red）
  - Commander.jsプログラム初期化のテスト作成
  - 基本コマンド登録のテスト作成
  - _要件: 1.1, 1.2_

- [x] 4.2 CLI基本構造実装（Green）
  - bin/kiro-lens.tsファイル作成
  - Commander.jsプログラム初期化実装
  - 基本的なコマンド構造実装
  - _要件: 1.1, 1.2_

- [x] 4.3 CLIオプション解析テスト作成（Red）
  - --portオプションのテスト作成
  - --frontend-port, --backend-portオプションのテスト作成
  - オプション解析結果の型安全性テスト作成
  - _要件: 1.2, 4.1_

- [x] 4.4 CLIオプション解析実装（Green）
  - portUtilsとの連携実装
  - オプション解析機能実装
  - 型安全なオプション処理実装
  - _要件: 1.2, 4.1_

- [x] 4.5 CLIヘルプ・バージョンテスト作成（Red）
  - --helpオプションのテスト作成
  - --versionオプションのテスト作成
  - ヘルプメッセージ内容のテスト作成
  - _要件: 1.4_

- [x] 4.6 CLIヘルプ・バージョン実装（Green）
  - package.jsonからバージョン取得実装
  - ヘルプメッセージ実装
  - 使用例の表示実装
  - _要件: 1.4_

- [x] 4.7 CLIリファクタリング（Refactor）
  - エラーメッセージの改善
  - ログ出力の統一
  - コード構造の最適化
  - _要件: 1.1, 1.2, 1.4_

- [x] 5. Fastify バックエンドサーバー基盤（TDD）

- [x] 5.1 Fastify基本サーバーテスト作成（Red）
  - Fastifyインスタンス作成のテスト作成
  - サーバー起動・停止のテスト作成
  - 指定ポートでの起動テスト作成
  - _要件: 2.3_

- [x] 5.2 Fastify基本サーバー実装（Green）
  - packages/backend/src/server.tsファイル作成
  - 最小限のFastifyサーバー実装
  - 基本的な起動・停止機能実装
  - _要件: 2.3_

- [x] 5.3 FastifyCORS設定テスト作成（Red）
  - CORS設定のテスト作成
  - オリジン制限のテスト作成
  - プリフライトリクエストのテスト作成
  - _要件: 2.4_

- [x] 5.4 FastifyCORS設定実装（Green）
  - @fastify/corsプラグイン統合実装
  - 開発環境用CORS設定実装
  - セキュリティ設定実装
  - _要件: 2.4_

- [x] 5.5 Fastifyエラーハンドリングテスト作成（Red）
  - 基本的なエラーハンドリングのテスト作成
  - 404エラーのテスト作成
  - 500エラーのテスト作成
  - _要件: 2.5_

- [x] 5.6 Fastifyエラーハンドリング実装（Green）
  - グローバルエラーハンドラー実装
  - 統一されたエラーレスポンス形式実装
  - ログ出力機能実装
  - _要件: 2.5_

- [x] 5.7 Fastifyサーバーリファクタリング（Refactor）
  - 設定の外部化
  - プラグイン構造の整理
  - パフォーマンス最適化
  - _要件: 2.3, 2.4, 2.5_

- [ ] 6. ヘルスチェックAPI（TDD）

- [ ] 6.1 ヘルスチェック型定義実装
  - shared/src/types/health.tsファイル作成
  - HealthResponse型実装
  - 型安全性確保実装
  - _要件: 2.5, 4.2_

- [ ] 6.2 ヘルスチェックルートテスト作成（Red）
  - GET /api/health エンドポイントのテスト作成
  - レスポンス形式のテスト作成
  - ステータスコードのテスト作成
  - _要件: 2.5, 3.5_

- [ ] 6.3 ヘルスチェックルート実装（Green）
  - packages/backend/src/routes/health.tsファイル作成
  - 基本的なヘルスチェックエンドポイント実装
  - サーバー状態レスポンス実装
  - _要件: 2.5, 3.5_

- [ ] 6.4 ヘルスチェック機能拡張テスト作成（Red）
  - アップタイム計測のテスト作成
  - メモリ使用量チェックのテスト作成
  - _要件: 3.5_

- [ ] 6.5 ヘルスチェック機能拡張実装（Green）
  - アップタイム計測機能実装
  - システム情報取得実装
  - _要件: 3.5_

- [ ] 6.6 ヘルスチェックAPIリファクタリング（Refactor）
  - レスポンス形式の最適化
  - パフォーマンス監視機能追加
  - エラーハンドリング改善
  - _要件: 2.5, 3.5_

- [-] 7. プロジェクト情報型定義（TDD）

- [x] 7.1 プロジェクト情報型実装
  - shared/src/types/project.tsファイル作成
  - ProjectInfo型実装
  - 型安全性確保実装
  - _要件: 3.2, 4.2_

- [x] 8. プロジェクト情報API（TDD）

- [x] 8.1 プロジェクト情報APIテスト作成（Red）
  - GET /api/project エンドポイントのテスト作成
  - .kiroディレクトリ検出のテスト作成
  - プロジェクト名取得のテスト作成
  - _要件: 3.2, 3.4_

- [x] 8.2 プロジェクト情報API実装（Green）
  - packages/backend/src/routes/project.tsファイル作成
  - .kiroディレクトリ存在確認機能実装
  - 基本的なプロジェクト情報レスポンス実装
  - _要件: 3.2, 3.4_

- [x] 8.3 プロジェクト情報APIリファクタリング（Refactor）
  - プロジェクト情報の詳細化
  - エラーハンドリングの改善
  - キャッシュ機能の追加
  - _要件: 3.2, 3.4_

- [x] 9. Vite設定（TDD）

- [x] 9.1 Vite設定ファイル実装
  - packages/frontend/vite.config.tsファイル作成
  - 基本的なVite設定実装
  - TypeScript統合設定実装
  - _要件: 2.2_

- [x] 10. React基本セットアップ（TDD）

- [x] 10.1 React基本セットアップテスト作成（Red）
  - Reactコンポーネントのテスト作成
  - App.tsxの基本構造テスト作成
  - _要件: 2.2, 3.1_

- [x] 10.2 React基本セットアップ実装（Green）
  - packages/frontend/src/App.tsxファイル作成
  - packages/frontend/src/main.tsxファイル作成
  - 最小限のReactアプリケーション実装
  - _要件: 2.2, 3.1_

- [x] 11. 開発サーバー起動（TDD）

- [x] 11.1 開発サーバー起動実装
  - package.jsonスクリプト設定実装
  - 開発サーバー設定実装
  - _要件: 2.2_

- [x] 11.2 Viteプロジェクトリファクタリング（Refactor）
  - ビルド設定の最適化
  - 開発体験向上設定
  - アセット管理の改善
  - _要件: 2.2, 3.1_

- [x] 12. Tailwind CSS v4セットアップ（TDD）

- [x] 12.1 Tailwind CSS v4セットアップ実装
  - Tailwind CSS v4設定ファイル作成
  - 基本的なカスタムテーマ設定実装
  - 日本語フォント（Noto Sans JP）設定実装
  - _要件: 2.2, 3.1_

- [ ] 13. shadcn/uiセットアップ（TDD）

- [ ] 13.1 shadcn/uiセットアップ実装
  - shadcn/ui初期化実装
  - 基本コンポーネント（Button、Card、Badge等）のインストール
  - TypeScript型定義の統合実装
  - _要件: 2.2, 3.1_

- [ ] 13.2 UI設定リファクタリング（Refactor）
  - Tailwind CSS v4とshadcn/uiの統合最適化
  - カスタムテーマとコンポーネントの一貫性確保
  - アクセシビリティ設定の強化
  - _要件: 2.2, 3.1_

- [ ] 14. 基本API通信（TDD）

- [ ] 14.1 API通信ラッパーテスト作成（Red）
  - fetch APIラッパーのテスト作成
  - 基本的なHTTPメソッドのテスト作成
  - _要件: 2.4_

- [ ] 14.2 API通信ラッパー実装（Green）
  - packages/frontend/src/services/api.tsファイル作成
  - 基本的なfetch APIラッパー実装
  - 型安全なAPI通信実装
  - _要件: 2.4_

- [ ] 15. ヘルスチェック通信（TDD）

- [ ] 15.1 ヘルスチェック通信テスト作成（Red）
  - ヘルスチェック通信のテスト作成
  - useHealthカスタムフックのテスト作成
  - _要件: 3.5_

- [ ] 15.2 ヘルスチェック通信実装（Green）
  - packages/frontend/src/hooks/useHealth.tsファイル作成
  - useHealthフック実装
  - ヘルスチェック状態管理実装
  - _要件: 3.5_

- [ ] 15.3 API通信リファクタリング（Refactor）
  - エラーハンドリングの改善
  - リトライ機能の追加
  - 型安全性の強化
  - _要件: 2.4, 3.5_

- [ ] 16. Dashboard レイアウトコンポーネント（TDD）

- [ ] 16.1 Dashboardテスト作成（Red）
  - 基本レイアウト構造のテスト作成
  - プロジェクト名表示のテスト作成
  - レスポンシブデザインのテスト作成
  - _要件: 3.1, 3.2_

- [ ] 16.2 Dashboard実装（Green）
  - packages/frontend/src/components/Dashboard.tsxファイル作成
  - 基本的なヘッダー・サイドバー・メインコンテンツ構造実装
  - プロジェクト名表示機能実装
  - _要件: 3.1, 3.2_

- [ ] 16.3 Dashboardリファクタリング（Refactor）
  - レイアウトの最適化
  - アクセシビリティ改善
  - スタイリングの統一
  - _要件: 3.1, 3.2_

- [ ] 17. Header コンポーネント（TDD）

- [ ] 17.1 Headerテスト作成（Red）
  - プロジェクト名表示のテスト作成
  - 接続状態インジケーターのテスト作成
  - ヘッダーレイアウトのテスト作成
  - _要件: 3.2, 3.5_

- [ ] 17.2 Header実装（Green）
  - packages/frontend/src/components/Header.tsxファイル作成
  - プロジェクト名とステータス表示実装
  - 基本的なスタイリング実装
  - _要件: 3.2, 3.5_

- [ ] 17.3 Headerリファクタリング（Refactor）
  - ビジュアルデザインの改善
  - インタラクティブ要素の追加
  - アニメーション効果の実装
  - _要件: 3.2, 3.5_

- [ ] 18. Sidebar コンポーネント（TDD）

- [ ] 18.1 Sidebarテスト作成（Red）
  - .kiroディレクトリ表示のテスト作成
  - ディレクトリ未存在時のメッセージ表示テスト作成
  - サイドバーレイアウトのテスト作成
  - _要件: 3.3, 3.4_

- [ ] 18.2 Sidebar実装（Green）
  - packages/frontend/src/components/Sidebar.tsxファイル作成
  - .kiroディレクトリ存在確認と表示実装
  - 基本的なファイルアイコン表示実装
  - _要件: 3.3, 3.4_

- [ ] 18.3 Sidebarリファクタリング（Refactor）
  - ビジュアルデザインの改善
  - アイコンとスタイリングの統一
  - 将来の拡張性を考慮した構造改善
  - _要件: 3.3, 3.4_

- [ ] 19. MainContent コンポーネント（TDD）

- [ ] 19.1 MainContentテスト作成（Red）
  - 基本コンテンツ表示のテスト作成
  - ウェルカムメッセージ表示のテスト作成
  - .kiroディレクトリ未存在時のメッセージテスト作成
  - _要件: 3.1, 3.4_

- [ ] 19.2 MainContent実装（Green）
  - packages/frontend/src/components/MainContent.tsxファイル作成
  - 基本的なウェルカムメッセージ表示実装
  - 条件分岐による表示切り替え実装
  - _要件: 3.1, 3.4_

- [ ] 19.3 MainContentリファクタリング（Refactor）
  - コンテンツレイアウトの改善
  - 情報表示の充実
  - 将来の機能拡張を考慮した構造改善
  - _要件: 3.1, 3.4_

- [ ] 20. サーバー起動統合機能（TDD）

- [ ] 20.1 サーバー起動統合テスト作成（Red）
  - CLI実行からサーバー起動までの統合テスト作成
  - concurrently による並行起動のテスト作成
  - プロセス終了処理のテスト作成
  - _要件: 1.1, 1.5, 2.3_

- [ ] 20.2 サーバー起動統合実装（Green）
  - テストを通すための最小限の統合機能実装
  - concurrently を使用した並行起動実装
  - 基本的なプロセス管理実装
  - _要件: 1.1, 1.5, 2.3_

- [ ] 20.3 サーバー起動統合リファクタリング（Refactor）
  - 起動プロセスの最適化
  - エラーハンドリングの改善
  - ログ出力とユーザビリティ向上
  - _要件: 1.1, 1.5, 2.3_

- [ ] 21. 高度なポート管理機能（TDD）

- [ ] 21.1 ポート検出・競合処理テスト作成（Red）
  - 利用可能ポート検出機能のテスト作成
  - ポート競合検出のテスト作成
  - ランダムポート割り当てのテスト作成
  - 複数プロジェクト同時起動のテスト作成
  - ポート使用状況監視のテスト作成
  - _要件: 1.3, 5.1, 5.2_

- [ ] 21.2 高度なポート管理実装（Green）
  - テストを通すための高度なPortManager機能実装
  - 利用可能ポート検出アルゴリズム実装
  - ポート競合時の代替ポート提案機能実装
  - ランダムポート割り当て機能実装
  - _要件: 1.3, 5.1, 5.2_

- [ ] 21.3 高度なポート管理リファクタリング（Refactor）
  - ポート検出アルゴリズムの最適化
  - 競合解決ロジックの改善
  - パフォーマンス最適化
  - _要件: 1.3, 5.1, 5.2_

- [ ] 22. エラーハンドリングとログ機能（TDD）

- [ ] 22.1 エラーハンドリングテスト作成（Red）
  - FoundationError型のテスト作成
  - ポート競合エラーハンドリングのテスト作成
  - ユーザーフレンドリーなエラーメッセージのテスト作成
  - _要件: 1.3, 5.3_

- [ ] 22.2 エラーハンドリング実装（Green）
  - テストを通すための最小限のエラー処理実装
  - 基本的なエラーメッセージ表示実装
  - ログ出力機能実装
  - _要件: 1.3, 5.3_

- [ ] 22.3 エラーハンドリングリファクタリング（Refactor）
  - エラーメッセージの改善
  - 復旧手順の提案機能追加
  - ログレベルとフォーマットの最適化
  - _要件: 1.3, 5.3_

- [ ] 23. 統合テストとE2E検証（TDD）

- [ ] 23.1 統合テスト作成（Red）
  - CLI実行からブラウザアクセスまでのE2Eテスト作成
  - 複数プロジェクト同時起動のテスト作成
  - ポート指定オプションの動作テスト作成
  - 高度なポート管理機能の統合テスト作成
  - _要件: 1.1, 1.2, 5.1, 5.4_

- [ ] 23.2 統合テスト実装（Green）
  - テストを通すための統合機能実装
  - エンドツーエンドフローの動作確認
  - 基本的なユーザーシナリオの実装
  - _要件: 1.1, 1.2, 5.1, 5.4_

- [ ] 23.3 統合テストリファクタリング（Refactor）
  - テストの安定性向上
  - 包括的なテストカバレッジ確保
  - CI/CD統合準備
  - _要件: 1.1, 1.2, 5.1, 5.4_

- [ ] 24. ドキュメントとREADME作成

- [ ] 24.1 基本ドキュメント作成
  - README.md作成（インストール、使用方法）
  - CLI使用方法のドキュメント作成
  - トラブルシューティングガイド作成
  - _要件: 1.1, 1.2, 1.3_

- [ ] 24.2 開発者向けドキュメント作成
  - 開発環境セットアップガイド作成
  - アーキテクチャ概要ドキュメント作成
  - 次のスペック（kiro-lens-core-api）への接続ガイド作成
  - _要件: 2.1, 4.5_

- [ ] 24.3 ユーザーガイド作成
  - 基本的な使用方法ガイド作成
  - よくある質問（FAQ）作成
  - コミュニティ貢献ガイド作成
  - _要件: 1.1, 5.1_

## 完了基準

このスペックは以下の条件を満たした時点で完了とします：

### 機能的完了基準

- ✅ `npx kiro-lens` でランダムポートでサーバーが起動する
- ✅ `npx kiro-lens --port 3000` で指定ポートでサーバーが起動する
- ✅ ブラウザでダッシュボードにアクセスできる
- ✅ プロジェクト名と.kiroディレクトリ状態が表示される
- ✅ ヘルスチェックAPIが正常に動作する
- ✅ 複数プロジェクトで同時起動できる

### 技術的完了基準

- ✅ 全てのテストが通過する
- ✅ TypeScriptコンパイルエラーがない
- ✅ ESLintエラーがない
- ✅ 基本的なドキュメントが整備されている

### 品質基準

- ✅ テストカバレッジ80%以上
- ✅ 起動時間5秒以内
- ✅ メモリ使用量100MB以内
- ✅ 基本的なアクセシビリティ要件を満たす
