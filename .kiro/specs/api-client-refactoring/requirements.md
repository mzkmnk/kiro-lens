# 要件ドキュメント

## 概要

kiro-lensプロジェクトのフロントエンド（packages/frontend/src/services/）において、現在のApiClientクラスが汎用的なHTTP通信とビジネスロジックを混在させている設計上の問題を解決するため、関心の分離に基づいたアーキテクチャにリファクタリングします。単一責任原則に従い、汎用HTTP通信層とビジネス固有のAPI層を分離し、保守性・拡張性・テスタビリティを向上させます。

## 要件

### 要件1：kyライブラリを活用したHTTP通信基盤の構築

**ユーザーストーリー:** フロントエンド開発者として、実績のある`ky`ライブラリを活用してHTTP通信を処理し、自前実装ではなく信頼性の高いライブラリに任せることで、ビジネスロジックの実装に集中したい。

#### 受け入れ基準

1. WHEN kyライブラリを導入 THEN プロジェクトの依存関係にky@1.10.0を追加する
2. WHEN HTTP通信設定 THEN kyインスタンスでベースURLや共通ヘッダーを設定する
3. WHEN エラーハンドリング THEN kyの標準的なエラーハンドリング機構を活用する
4. WHEN 型安全性 THEN kyのTypeScript対応を活用して型安全なAPI通信を実現する
5. WHEN 設定の共通化 THEN 全てのAPIサービスで共通のkyインスタンスを使用する

### 要件2：プロジェクト管理API層の分離

**ユーザーストーリー:** フロントエンド開発者として、プロジェクト管理に関するAPI呼び出しを専用のサービスクラスに分離し、関心の分離を実現したい。

#### 受け入れ基準

1. WHEN ProjectApiServiceクラスを作成 THEN kyインスタンスを使用してプロジェクト管理APIを提供する
2. WHEN APIメソッド THEN addProject、removeProject、getProjects、validatePath、selectProjectメソッドを提供する
3. WHEN エラーハンドリング THEN プロジェクト固有のエラーメッセージとエラー処理を提供する
4. WHEN 型安全性 THEN 既存の型定義（AddProjectResponse、ProjectListResponse等）を活用する
5. WHEN レスポンス処理 THEN ApiResponse形式からのデータ抽出処理を適切に実装する

### 要件3：ファイルツリーAPI層の分離

**ユーザーストーリー:** フロントエンド開発者として、ファイルツリー機能に関するAPI呼び出しを専用のサービスクラスに分離し、機能別の責任を明確にしたい。

#### 受け入れ基準

1. WHEN FileTreeApiServiceクラスを作成 THEN kyインスタンスを使用してファイルツリーAPIを提供する
2. WHEN APIメソッド THEN getProjectFilesメソッドを提供する
3. WHEN バリデーション THEN プロジェクトIDの検証とURLエンコード処理を実装する
4. WHEN エラーハンドリング THEN ファイルツリー固有のエラーメッセージを提供する
5. WHEN 型安全性 THEN FileTreeResponse型を活用した型安全な実装を提供する

### 要件4：後方互換性の確保

**ユーザーストーリー:** フロントエンド開発者として、既存のコードを段階的に移行できるよう、後方互換性を保ちながらリファクタリングを実施したい。

#### 受け入れ基準

1. WHEN 移行期間中 THEN 既存のApiClientクラスが引き続き動作する
2. WHEN 新しいサービス THEN 既存のApiClientと同じインターフェースを提供する
3. WHEN 統一エクスポート THEN index.tsで新旧両方のAPIを提供する
4. WHEN 段階的移行 THEN 既存のテストが引き続き通過する
5. WHEN 完全移行後 THEN 古いApiClientクラスを安全に削除できる

### 要件5：テスト戦略の改善

**ユーザーストーリー:** フロントエンド開発者として、分離されたアーキテクチャに対応したテスト戦略を実装し、各層の責任を明確にテストしたい。

#### 受け入れ基準

1. WHEN HTTP通信テスト THEN kyライブラリの設定と統合部分のみをテストする
2. WHEN ProjectApiServiceテスト THEN プロジェクト管理ロジックとエラーハンドリングをテストする
3. WHEN FileTreeApiServiceテスト THEN ファイルツリー機能とバリデーションをテストする
4. WHEN モック戦略 THEN 各層で適切なモック対象を設定する
5. WHEN テスト分離 THEN 汎用機能とビジネスロジックのテストを分離する
